module Game

open "UnityEngine.dll"
open UnityEngine

worldEntity World = {

  Goblins   : [Goblin]   
  AvatarGen : AvatarGenerator 
 
    //rule Goblins =
   //   for x in [0..AvatarGen.Amount - 1] do
     //   for characteristic in Avatar Gen.SettingsList do
    //        yield (Goblin.Create([(characteristic.Item1, 8)])) :: Goblins  
 //     wait false

  rule Goblins =
    for x in [0..AvatarGen.Amount - 1] do
      yield (Goblin.Create(
              [for characteristic in AvatarGen.SettingsList do 
              select (characteristic.Item1, 
                    Random.Range(characteristic.Item2.Item1, 
                    characteristic.Item2.Item2))]
            )) :: Goblins  
    wait false
 
  rule Goblins = 
    for goblin in Goblins do
      for personality in goblin.settings do
         AvatarGenerator.Log(personality.Item1) 
    yield Goblins
  
  Create() =  
    let avatar_generator = AvatarGenerator.Find()
    {
       AvatarGen = avatar_generator 
       Goblins = []
    }    
}


 
entity Goblin = { 
  inherit UnityGoblin 
  settings : [(string * int)]
     
  //moving right           
  rule Position, IsMovingLegs =    
    wait Input.GetKey(KeyCode.Space) 
    yield Position + new Vector3(dt *2.0f, 0.0f, 0.0f), true    

  //moving left
  rule Position, IsMovingLegs =
    wait Input.GetKey(KeyCode.C)
    yield Position - new Vector3(dt*2.0f, 0.0f, 0.0f), true
      
  Create(Settings : [(string * int)]) =  
    {
      settings = Settings  
      UnityGoblin = UnityGoblin.Instantiate()
    }
}  


